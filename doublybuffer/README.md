# DoublyBuffer

在服务端开发中，我们经常会碰到需要热加载的情况，需要不影响持续请求的情况下更新数据，
双buffer是很常见的一种手段。这种数据结构类似于读写锁，支持读多写少的场景。

假设初始index=0，现在考虑两个线程，一个写者，一个读者
| Reader| Writer |
|--------| -----:|
|            |写buffer[1] |
| 读index=0  |            |
|            |更新index=>1|
|            |检查buffer[0]的引用计数不大于1|
| 更新buffer[0]引用计数 |写buffer[0]数据|
存在读写冲突。冲突的原因在于，两个引用计数虽然是原子的，但是在读index和修改index对应的引用计数之间不是原子的。